<!--
	Ant build script for the FindBugs Eclipse Plugin.

	Use the fbjars target to update the FindBugs jars that this
	plugin needs.

	Use the dist target to build a distributable, which runs the
	Eclipse-built classes through a conversion process, so that
	the plugin may run on 1.4 vms. This target assumes the plugin has already
	been built from within Eclipse, and the binaries reside in the "bin.dir"
-->

<project name="fbeclipse" default="fbjars">

	<property file="build.properties" />

<!-- 
	The local.properties properties file contains the location of eclipsePlugin.dir 

	This value is likely to be different for each checkout of the plugin,
	so the local.properties file is not managed by cvs
	
-->
	<property file="local.properties" />

	<property name="fbeclipse.dir" value="."/>

	<property name="src.dir" value="src"/>
	<property name="lib.dir" value="lib"/>
	<property name="dist.dir" value="dist"/>
	<property name="tools.dir" value="tools"/>
	<!-- the binaries/classes, built by eclipse. -->
	<property name="bin.dir" value="bin" />

	<path id="plugin.classpath">
		<fileset dir="${eclipsePlugin.dir}">
			<include name="org.eclipse*.jar"/>
		</fileset>
		<fileset file="findbugs.jar"/>
		<fileset file="bcel.jar"/>
		<fileset file="dom4j-full.jar"/>
	</path>

	<target name="init">
		<mkdir dir="${dist.dir}"/>
		<mkdir dir="${bin.dir}"/>
	</target>

	<target name="clean" description="Clean up temporary files">
		<mkdir dir="${dist.dir}"/>
		<mkdir dir="${bin.dir}"/>
		<delete includeEmptyDirs="true">
			<fileset dir="${dist.dir}" />
			<fileset dir="${bin.dir}" />
		</delete>
		<mkdir dir="${dist.dir}"/>
		<mkdir dir="${bin.dir}"/>
	</target>

	<target name="classes" depends="init,fbjars" description="Compile java source files">
        <mkdir dir="${bin.dir}"/>
        <!-- Compile Java source files. -->
        <javac srcdir="${src.dir}"
		  destdir="${bin.dir}"
                source="1.5"
                target="jsr14"
                debug="on">
            <classpath refid="plugin.classpath"/>
        </javac>
	</target>

	

	<target name="dist" depends="clean,classes" description="Build a plugin distributable, including the conversion of all classes to 1.4 compatible bytecode">

		<jar destfile="${dist.dir}/findbugs-plugin.jar">
				<fileset dir="${bin.dir}" />
		</jar>
		<copy todir="${dist.dir}">
			<fileset file="bcel.jar" />
			<fileset file="dom4j-full.jar" />
			<fileset file="findbugs.jar" />
			<fileset file="plugin.xml" />
			<fileset file="plugin.properties" />
		</copy>
		<copy todir="${dist.dir}/plugin">
			<fileset dir="plugin" />
		</copy>
		<copy todir="${dist.dir}/icons">
			<fileset dir="icons" />
		</copy>
	</target>

	<target name="fbjars" description="Copy required jar files from the main findbugs project (which should be a sibling of this project)">
		<ant dir="${findbugs.dir}" inheritall="false" target="build"/>
		<copy todir="${fbeclipse.dir}">
			<fileset dir="${findbugs.dir}/lib" includes="findbugs.jar,bcel.jar,annotations.jar"/>
		</copy>
		<copy todir="${fbeclipse.dir}/plugin">
			<fileset dir="${findbugs.dir}/plugin" includes="coreplugin.jar"/>
		</copy>
	</target>
</project>
