
<html>
<head>
<title>Data mining of bugs with FindBugs</title>
<link rel="stylesheet" type="text/css" href="findbugs.css">
</head>
<body>

<table width="100%"><tr>

@HTML_SIDEBAR@

<td align="left" valign="top">


<h1>
Data mining of bugs with FindBugs
</h1>

<p>
FindBugs now incorporates an ability to perform sophisticated queries on bug
databases and track warnings across multiple versions of code being
studied, allowing you to do things such as seen when a bug was first introduced, or to examine
just the warnings that have been introduced since the last release, or to graph the number
of infinite recursive loops in your code over time.

<p>
These techniques all depend upon the XML storage format used by FindBugs for storing warnings.
These XML files usually contain just the warnings from a particular analysis run, but
you can also store the results from analyzing a sequence of software builds or versions.

<p>
Any FindBugs XML bug database contains a version name and timestamp. 
FindBugs tries to compute a timestamp from the timestamps of the files that
are analyzed (e.g., the timestamp is intended to be the time the class files
were generated, not analyzed). Each bug database also contains a version name.
Both the version name and timestamp can be set manually using the 
<a href="#setBugDatabaseInfo>setBugDatabaseInfo</a>
command.

<p>A multiversion bug database assigns a sequence number to each version of
the analyzed code. These sequence numbers are simply successive integers,
starting at 0 (e.g., a bug database for 4 versions of the code will contain
versions 0..3). The bug database will also record the name and timestamp for
each version. The <a href="#filterBugs">filterBugs</a> command allows you to refer
to a version by sequence number, name or timestamp.

<p>
You can take a sequence (or pair) of single version bug databases and create
from them a multiversion bug database, or combine a multiversion bug database
with a sequence of later single-version bug databases.

<h2>Commands</h2>
<p>
The current tools for FindBugs data mining are designed to be invoked
from the command line.

<p>
Briefly, the commands are:

<dl>
<dt><a href="#unionBugs">unionBugs</a><dd> combine the results from separate analysis of disjoint
		classes
<dt><a href="#computeBugHistory">computeBugHistory</a><dd> Merge bug warnings from multiple versions of
			analyzed code into
			a single multiversion bug database. This can either be used
			to add more versions to an existing multiversion database,
			or to create a multiversion database from a sequence of single version
			bug warning databases.
<dt><a href="#setBugDatabaseInfo">setBugDatabaseInfo</a><dd> Set information such as the revision name or
timestamp in an XML bug database
<dt><a href="#listBugDatabaseInfo">listBugDatabaseInfo</a><dd> List information such as the revision name and
timestamp for a list of XML bug databases
<dt><a href="#filterBugs">filterBugs</a><dd> Select a subset of a bug database
<dt><a href="#mineBugHistory">mineBugHistory</a><dd> Generate a tabular listing of the number of warnings in each
		version of a multiversion bug database
<dt><a href="#defectDensity">defectDensity</a><dd>
	List information about defect density (warnings per 1000 NCSS) for the entire project and each class and package.
<dt><a href="#convertXmlToText">convertXmlToText</a><dd> Convert bug warnings in XML format to 
		a textual, one line per bug, format
</dl>

<h3><a name="unionBugs"><h3>unionBugs</a></h3> 
<p>
If you have, for example, seperately analyzing each jar file used in an application,
	you can use this command to combine the seperately generated xml bug warning files into
	a single file containing all of the warnings.
<p>Do <em>not</em> use this command to combine results from analyzing different versions of the same
file; use computeBugHistory instead.

<h3><a name="computeBugHistory">computeBugHistory</a></h3>
<p>Use this command to generate a bug database containing information from different builds or versions
	of software you are analyzing. History is taken from the first file provided as input; any following 
	files should be single version bug databases (if they contain history the history in those
	files will be ignored). 
	<p>The file the combined history is written to can be provided using the -output option, otherwise
	it is written to standard output. The output file is not written until all input files are read, so
	you can overwrite one of the input files if you wish.
	
<table>
<tr><th>Option<th>meaning
<tr><td>-output &lt;filename&gt;                        <td>name of file to write output to (standard out otherwise)
</table>
	
	
<h3><a name="filterBugs"><h3>filterBugs</a></h3>
<p>This command is used to select a subset of warnings from a FindBugs XML warning file
and write the selected subset to a new FindBugs warning file.
<p>
This command takes a sequence of options, and either zero, one or two
filenames of findbugs xml bug files on the command line.
<p>If no file names are provided, the command reads from standard input
and writes to standard output. If one file name is provided,
it reads from the file and writes to standard output.
If two file names are provided, it reads from the first and writes the output
to the second file name.

<p>
<table>
<tr><th>Option<th>meaning
<tr><td>-not                        <td>reverse (all) switches for the filter
<tr><td>-withSource[:truth]           <td>only warnings for switch source is available
<tr><td>-exclude &lt;filter file&gt;      <td>exclude bugs matching given filter
<tr><td>-include &lt;filter file&gt;      <td>include only bugs matching given filter
<tr><td>-annotation &lt;text&gt;          <td>allow only warnings containing this text in a manual annotation
<tr><td>-classified[:truth]         <td>allow only classified warnings
<tr><td>-serious[:truth]            <td>allow only warnings manually classified as serious
<tr><td>-after &lt;when&gt;               <td>allow only warnings that first occurred after this version
<tr><td>-before &lt;when&gt;              <td>allow only warnings that first occurred before this version
<tr><td>-first &lt;when&gt;               <td>allow only warnings that first occurred in this version
<tr><td>-last &lt;when&gt;                <td>allow only warnings that last occurred in this version
<tr><td>-present &lt;when&gt;             <td>allow only warnings present in this version
<tr><td>-absent &lt;when&gt;              <td>allow only warnings absent in this version
<tr><td>-active[:truth]             <td>allow only warnings alive in the last sequence number
<tr><td>-introducedByChange[:truth] <td>allow only warnings introduced by a change of an existing class
<tr><td>-removedByChange[:truth]    <td>allow only warnings removed by a change of a persisting class
<tr><td>-newCode[:truth]            <td>allow only warnings introduced by the addition of a new class
<tr><td>-removedCode[:truth]        <td>allow only warnings removed by removal of a class
<tr><td>-priority &lt;level&gt;           <td>allow only warnings with this priority or higher
<tr><td>-class &lt;pattern&gt;            <td>allow only bugs whose primary class name matches this pattern
<tr><td>-bugPattern &lt;pattern&gt;       <td>allow only bugs whose type matches this pattern
<tr><td>-category &lt;category&gt;        <td>allow only warnings with a category that starts with this string
</table>

<h3><a name="mineBugHistory"><h3>mineBugHistory</a></h3>

<p>This command generates a table containing counts of the numbers of warnings
in each version of a multiversion bug database.
<p>The options are:
<table>
<tr><th>option<th>meaning
 <tr><td>-formatDates                 <td>render dates in textual form
 </td>
 </table>
 <p>The table is a tab seperated table with the following columns:
 
 <table>
 <tr><th>title<th>Meaning
 <tr><td>seq<td>Sequence number (successive integers, starting at 0)
 <tr><td>version<td>version name
 <tr><td>time<td>Release timestamp
 <tr><td>classes<td>Number of classes analyzed
 <tr><td>NCSS<td>Non Commenting Source Statements
 <tr><td>added<td>Count of new warnings for a class that existed in the previous version
 <tr><td>newCode<td>Count of new warnings for a class that did not exist in the previous version
 <tr><td>fixed<td>Count of warnings removed from a class that remains in the current version
 <tr><td>removed<td>Count of warnings in the previous version for a class that is not present in the current version
 <tr><td>retained<td>Count of warnings that were in both the previous and current version
 <tr><td>dead<td>Warnings that were present in earlier versions but in neither the current version or the immediately preceeding version
 <tr><td>active<td>Total warnings present in the current version
 </table>
 

<h3><a name="defectDensity"><h3>defectDensity</a></h3>
<p>
This command lists information about defect density (warnings per 1000 NCSS) for the entire project and each class and package.
In can either be invoked with no files specified on the command line (in which case it reads from standard input)
or with one file specified on the command line.
<p>It generates a table with the following columns, and with one
row for the entire project, and one row for each package or class that contains at least
4 warnings.
<table>
<tr><td>kind<td>project, package or class
<tr><td>The name of the project, package or class
<tr><td>density/KNCSS<td>Number of warnings generated per 1000 lines of NCSS.
<tr><td>bugs<td>Number of warnings
<tr><td>NCSS<td>Calculated number of NCSS
</table>  

<h3><a name="convertXmlToText"><h3>convertXmlToText</a></h3>
<table>
<tr><th>option<th>meaning
<tr><td>  -longBugCodes <td>use long bug codes, rather than 2 letter bug codes, when generating text
</table>

<h3><a name="setBugDatabaseInfo"><h3>setBugDatabaseInfo</a></h3>
<table>
<tr><th>option<th>meaning
<tr><td>  -name &lt;name&gt;        <td>set name for (last) revision
<tr><td>  -timestamp &lt;when&gt;   <td>set timestamp for (last) revision
 <tr><td> -source &lt;directory&gt; <td>Add this directory to the source search path
</table>

<h3><a name="listBugDatabaseInfo"><h3>listBugDatabaseInfo</a></h3>
<p>This command takes a list of zero or more xml bug database filenames on the command line.
If zero file names are provided, it reads from standard input and does not generate
a table header.

<p>There is only one option:
<table>
<tr><th>option<th>meaning
 <tr><td>-formatDates                 <td>render dates in textual form
 </td>
 </table>
<p>The output is a table one row per bug database and the following columns:

<table>
 <tr><th>title<th>Meaning
 <tr><td>version<td>version name
 <tr><td>time<td>Release timestamp
 <tr><td>classes<td>Number of classes analyzed
 <tr><td>NCSS<td>Non Commenting Source Statements analyzed
 <tr><td>total<td>Total number of warnings of all kinds
 <tr><td>high<td>Total number of high priority warnings of all kinds
 <tr><td>medium<td>Total number of medium/normal priority warnings of all kinds
 <tr><td>low<td>Total number of low priority warnings of all kinds
 <tr><td>filename<td>filename of database
 </table>

<h2>Examples</h2>
<p>In all of the following, the commands are given in a directory that contains
directories jdk1.6.0-b12, jdk1.6.0-b13, ..., jdk1.6.0-b61, each of which contains 
a file jre/lib/rt.xml that contains the results of running FindBugs over rt.jar for that build.

<h3>Building a history file from scratch</h3>
<p>You can use the command:
<quote>
<pre>computeBugHistory -output db.xml jdk1.6.0-b*/jre/lib/rt.xml</pre>
</quote>
<p>to create a bug history file db.xml containing the historical information
from all of the jdk builds. Having created db.xml, we can use:
<quote>
<pre>filterBugs -bugPattern IL_ db.xml | mineBugHistory -formatDates</pre>
</quote>
<p>to examine the history of infinite recursive loops in JDK 1.6.0:
<quote>
<pre>
seq     version time    classes NCSS    added   newCode fixed   removed retained        dead    active
0       jdk1.6.0-b12    1100182040000   13128   811569  0       4       0       0       0       0       4
1       jdk1.6.0-b13    1100775726000   13128   811570  0       0       0       0       4       0       4
2       jdk1.6.0-b14    1101985946000   13145   811786  0       0       2       0       2       0       2
3       jdk1.6.0-b15    1102590424000   13174   811693  0       0       1       0       1       2       1
4       jdk1.6.0-b16    1103196088000   13175   811715  0       0       0       0       1       3       1
5       jdk1.6.0-b17    1103801242000   13176   811974  0       0       0       0       1       3       1
6       jdk1.6.0-b19    1105616476000   13176   812011  0       0       0       0       1       3       1
7       jdk1.6.0-b21    1106823472000   13177   812173  0       0       0       0       1       3       1
8       jdk1.6.0-b23    1108032276000   13179   812188  0       0       0       0       1       3       1
9       jdk1.6.0-b26    1109847842000   13199   811770  0       0       0       0       1       3       1
10      jdk1.6.0-b27    1110448118000   13189   812440  0       0       0       0       1       3       1
11      jdk1.6.0-b28    1111046062000   13185   812056  0       0       0       0       1       3       1
12      jdk1.6.0-b29    1111651760000   13117   809468  0       0       0       0       1       3       1
13      jdk1.6.0-b30    1112255612000   13118   809501  0       0       0       0       1       3       1
14      jdk1.6.0-b31    1112857214000   13117   809572  0       0       0       0       1       3       1
15      jdk1.6.0-b32    1113461816000   13169   811096  0       0       0       0       1       3       1
16      jdk1.6.0-b33    1114065982000   13187   811942  0       0       0       0       1       3       1
17      jdk1.6.0-b34    1114670940000   13195   813488  0       1       0       0       1       3       2
18      jdk1.6.0-b35    1115275744000   13457   829837  0       0       0       0       2       3       2
19      jdk1.6.0-b36    1115881186000   13462   831278  0       0       0       0       2       3       2
20      jdk1.6.0-b37    1116485708000   13464   831971  0       0       0       0       2       3       2
21      jdk1.6.0-b38    1117091296000   13564   836565  0       0       0       0       2       3       2
22      jdk1.6.0-b39    1117782648000   13856   849992  0       1       0       0       2       3       3
23      jdk1.6.0-b40    1118302228000   15972   959619  0       2       0       0       3       3       5
24      jdk1.6.0-b41    1118906362000   15972   959619  0       0       0       0       5       3       5
25      jdk1.6.0-b42    1119598734000   15966   958581  0       0       0       0       5       3       5
26      jdk1.6.0-b43    1121324974000   16041   960544  0       0       0       0       5       3       5
27      jdk1.6.0-b44    1121929554000   16041   960547  0       0       0       0       5       3       5
28      jdk1.6.0-b45    1122535570000   16037   960606  0       0       1       0       4       3       4
29      jdk1.6.0-b46    1123138968000   15936   951355  0       0       0       0       4       4       4
30      jdk1.6.0-b47    1123744736000   15964   952387  0       0       1       0       3       4       3
31      jdk1.6.0-b48    1124367040000   15970   953421  0       0       0       0       3       5       3
32      jdk1.6.0-b49    1124954678000   16048   958940  0       0       0       0       3       5       3
33      jdk1.6.0-b50    1125553960000   16287   974937  1       0       0       0       3       5       4
34      jdk1.6.0-b51    1126158936000   16362   979377  0       0       0       0       4       5       4
35      jdk1.6.0-b52    1126764248000   16477   979399  0       0       0       0       4       5       4
36      jdk1.6.0-b53    1127368828000   16019   957900  0       0       1       0       3       5       3
37      jdk1.6.0-b54    1127973274000   16019   957900  0       0       0       0       3       6       3
38      jdk1.6.0-b55    1128578054000   16051   959014  0       0       0       0       3       6       3
39      jdk1.6.0-b56    1129182852000   16211   970835  0       0       0       0       3       6       3
40      jdk1.6.0-b57    1129787726000   16279   971627  0       0       0       0       3       6       3
41      jdk1.6.0-b58    1130392590000   16283   971945  0       0       0       0       3       6       3
42      jdk1.6.0-b59    1131001018000   16232   972193  0       0       0       0       3       6       3
43      jdk1.6.0-b60    1131605658000   16235   972346  0       0       0       0       3       6       3
44      jdk1.6.0-b61    1132210722000   16202   971134  0       0       1       0       2       6       2
</pre>
</quote>
<p>We could also generate that information directly, without creating an intermediate db.xml file,
using the command
<quote>
<pre>computeBugHistory  jdk1.6.0-b*/jre/lib/rt.xml | filterBugs -bugPattern IL_ db.xml | mineBugHistory -formatDates</pre>
</quote>

<p>We can then use that information to display a graph showing the number of infinite recursive loops
found by FindBugs in each build of Sun's JDK1.6.0. The blue area indicates the number of infinite
recursive loops in that build, the red area above it indicates the number of infinite recursive loops that existed
in some previous version but not in the current version (thus, the combined height of the red and blue areas
is guaranteed to never decrease, and goes up whenever a new infinite recursive loop bug is introduced). The height
of the red area is computed as the sum of the fixed, removed and dead values for each version. The reductions in builds 13 and 14
came after Sun was notified about the bugs found by FindBugs in the JDK.

<p align=center><img src="infiniteRecursiveLoops.png">

<p>Given the db.xml file that contains the results for all the jdk1.6.0 builds, the following command
will show the history of high and medium priority correctness warnings:

<quote>
<pre>filterBugs -priority M -category C db.xml | mineBugHistory -formatDates</pre>
</quote>
generating the table:
<quote>
<pre>
seq	version	time	classes	NCSS	added	newCode	fixed	removed	retained	dead	active
0	jdk1.6.0-b12	"Thu Nov 11 09:07:20 EST 2004"	13128	811569	0	1075	0	0	0	0	1075
1	jdk1.6.0-b13	"Thu Nov 18 06:02:06 EST 2004"	13128	811570	0	0	0	0	1075	0	1075
2	jdk1.6.0-b14	"Thu Dec 02 06:12:26 EST 2004"	13145	811786	3	0	6	0	1069	0	1072
3	jdk1.6.0-b15	"Thu Dec 09 06:07:04 EST 2004"	13174	811693	2	1	3	0	1069	6	1072
4	jdk1.6.0-b16	"Thu Dec 16 06:21:28 EST 2004"	13175	811715	0	0	1	0	1071	9	1071
5	jdk1.6.0-b17	"Thu Dec 23 06:27:22 EST 2004"	13176	811974	0	0	1	0	1070	10	1070
6	jdk1.6.0-b19	"Thu Jan 13 06:41:16 EST 2005"	13176	812011	0	0	0	0	1070	11	1070
7	jdk1.6.0-b21	"Thu Jan 27 05:57:52 EST 2005"	13177	812173	0	0	1	0	1069	11	1069
8	jdk1.6.0-b23	"Thu Feb 10 05:44:36 EST 2005"	13179	812188	0	0	0	0	1069	12	1069
9	jdk1.6.0-b26	"Thu Mar 03 06:04:02 EST 2005"	13199	811770	0	0	2	1	1066	12	1066
10	jdk1.6.0-b27	"Thu Mar 10 04:48:38 EST 2005"	13189	812440	1	0	1	1	1064	15	1065
11	jdk1.6.0-b28	"Thu Mar 17 02:54:22 EST 2005"	13185	812056	0	0	0	0	1065	17	1065
12	jdk1.6.0-b29	"Thu Mar 24 03:09:20 EST 2005"	13117	809468	3	0	8	26	1031	17	1034
13	jdk1.6.0-b30	"Thu Mar 31 02:53:32 EST 2005"	13118	809501	0	0	0	0	1034	51	1034
14	jdk1.6.0-b31	"Thu Apr 07 03:00:14 EDT 2005"	13117	809572	0	0	0	0	1034	51	1034
15	jdk1.6.0-b32	"Thu Apr 14 02:56:56 EDT 2005"	13169	811096	1	1	0	1	1033	51	1035
16	jdk1.6.0-b33	"Thu Apr 21 02:46:22 EDT 2005"	13187	811942	3	0	2	1	1032	52	1035
17	jdk1.6.0-b34	"Thu Apr 28 02:49:00 EDT 2005"	13195	813488	0	1	0	0	1035	55	1036
18	jdk1.6.0-b35	"Thu May 05 02:49:04 EDT 2005"	13457	829837	0	36	2	0	1034	55	1070
19	jdk1.6.0-b36	"Thu May 12 02:59:46 EDT 2005"	13462	831278	0	0	0	0	1070	57	1070
20	jdk1.6.0-b37	"Thu May 19 02:55:08 EDT 2005"	13464	831971	0	1	1	0	1069	57	1070
21	jdk1.6.0-b38	"Thu May 26 03:08:16 EDT 2005"	13564	836565	1	7	2	6	1062	58	1070
22	jdk1.6.0-b39	"Fri Jun 03 03:10:48 EDT 2005"	13856	849992	6	39	5	0	1065	66	1110
23	jdk1.6.0-b40	"Thu Jun 09 03:30:28 EDT 2005"	15972	959619	7	147	11	0	1099	71	1253
24	jdk1.6.0-b41	"Thu Jun 16 03:19:22 EDT 2005"	15972	959619	0	0	0	0	1253	82	1253
25	jdk1.6.0-b42	"Fri Jun 24 03:38:54 EDT 2005"	15966	958581	3	0	1	2	1250	82	1253
26	jdk1.6.0-b43	"Thu Jul 14 03:09:34 EDT 2005"	16041	960544	5	11	15	8	1230	85	1246
27	jdk1.6.0-b44	"Thu Jul 21 03:05:54 EDT 2005"	16041	960547	0	0	0	0	1246	108	1246
28	jdk1.6.0-b45	"Thu Jul 28 03:26:10 EDT 2005"	16037	960606	19	0	2	0	1244	108	1263
29	jdk1.6.0-b46	"Thu Aug 04 03:02:48 EDT 2005"	15936	951355	13	1	1	32	1230	110	1244
30	jdk1.6.0-b47	"Thu Aug 11 03:18:56 EDT 2005"	15964	952387	163	8	7	20	1217	143	1388
31	jdk1.6.0-b48	"Thu Aug 18 08:10:40 EDT 2005"	15970	953421	0	0	0	0	1388	170	1388
32	jdk1.6.0-b49	"Thu Aug 25 03:24:38 EDT 2005"	16048	958940	1	11	1	0	1387	170	1399
33	jdk1.6.0-b50	"Thu Sep 01 01:52:40 EDT 2005"	16287	974937	19	27	16	7	1376	171	1422
34	jdk1.6.0-b51	"Thu Sep 08 01:55:36 EDT 2005"	16362	979377	1	15	3	0	1419	194	1435
35	jdk1.6.0-b52	"Thu Sep 15 02:04:08 EDT 2005"	16477	979399	0	0	1	1	1433	197	1433
36	jdk1.6.0-b53	"Thu Sep 22 02:00:28 EDT 2005"	16019	957900	13	12	16	20	1397	199	1422
37	jdk1.6.0-b54	"Thu Sep 29 01:54:34 EDT 2005"	16019	957900	0	0	0	0	1422	235	1422
38	jdk1.6.0-b55	"Thu Oct 06 01:54:14 EDT 2005"	16051	959014	1	4	7	0	1415	235	1420
39	jdk1.6.0-b56	"Thu Oct 13 01:54:12 EDT 2005"	16211	970835	6	8	37	0	1383	242	1397
40	jdk1.6.0-b57	"Thu Oct 20 01:55:26 EDT 2005"	16279	971627	0	0	0	0	1397	279	1397
41	jdk1.6.0-b58	"Thu Oct 27 01:56:30 EDT 2005"	16283	971945	0	1	1	0	1396	279	1397
42	jdk1.6.0-b59	"Thu Nov 03 01:56:58 EST 2005"	16232	972193	6	0	5	0	1392	280	1398
43	jdk1.6.0-b60	"Thu Nov 10 01:54:18 EST 2005"	16235	972346	0	0	0	0	1398	285	1398
44	jdk1.6.0-b61	"Thu Nov 17 01:58:42 EST 2005"	16202	971134	2	0	4	0	1394	285	1396
</pre>
</quote>

<h3>Incremental history mantainance</h3>
<p>If db.xml contains the results of running findbugs over builds b12 - b60, we can update db.xml to include
the results of analyzing b61 with the commands:
quote>
<pre>computeBugHistory -output db.xml db.xml jdk1.6.0-b61/jre/lib/rt.xml</pre>
</quote>


@HTML_FOOTER@

</td>

</tr></table>

</body>
</html>

