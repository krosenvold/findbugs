<project name="webCloudServerCommon" default="compile">
    <path id="common.classpath">
        <path location="../webCloudProtocol/build/webCloudProtocol-full.jar"/>
        <fileset dir="lib" includes="*.jar"/>
    </path>

    <target name="clean">
        <delete dir="classes-ant"/>
        <delete dir="classes-tests-ant"/>
        <delete dir="build"/> 
    </target>

    <target name="compile">
        <ant dir="../webCloudProtocol" target="fulljar" inheritall="false"/>
        <mkdir dir="classes-ant"/>
        <javac srcdir="src/java" destdir="classes-ant" classpathref="common.classpath" debug="on" />
    </target>

    <target name="compile-tests" depends="compile">
        <mkdir dir="classes-tests-ant"/>
        <javac srcdir="src/junit" destdir="classes-tests-ant" debug="on">
            <classpath>
                <path refid="common.classpath"/>
                <path location="classes-ant"/>
            </classpath>
        </javac>
    </target>

    <target name="fulljar-check" depends="compile">
        <uptodate property="fulljar-not-necessary"
                  targetfile="build/webCloudServerCommon-full.jar">
            <srcfiles dir="classes-ant" includes="**/*"/>
            <srcfiles dir="lib" includes="**/*"/>
            <srcfiles file="../webCloudProtocol/build/webCloudProtocol-full.jar"/>
        </uptodate>
    </target>

    <target name="fulljar" depends="fulljar-check" unless="fulljar-not-necessary">
        <mkdir dir="build"/>
        <jar jarfile="build/webCloudServerCommon-full.jar">
            <fileset dir="classes-ant"/>

            <zipfileset src="../webCloudProtocol/build/webCloudProtocol-full.jar"/>

            <zipfileset src="lib/charts4j-1.2.jar"/>
            <zipfileset src="lib/commons-lang-2.5.jar"/>
            <zipfileset src="lib/dyuproject-openid-1.1.6.jar"/>
            <zipfileset src="lib/dyuproject-util-1.1.6.jar"/>
            <zipfileset src="lib/guava-r05.jar"/>
            <zipfileset src="lib/jdo2-api-2.3-eb.jar"/>
            <zipfileset src="lib/jetty-util-6.1.19.jar"/>
            <zipfileset src="lib/servlet-api-2.5-20081211.jar"/>
        </jar>
    </target>
</project>